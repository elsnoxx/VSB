<Window x:Class="ParkingLotWPF.Views.UserEditDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:ParkingLotWPF.Converters"
        Title="Editace uživatele" Height="600" Width="600" WindowStartupLocation="CenterOwner">
    <Window.Resources>
        <local:CarParkedToEnabledConverter x:Key="CarParkedToEnabledConverter"/>
    </Window.Resources>
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- User Info (only first and last name shown) -->
        <Grid Grid.Row="0" Margin="0,0,0,10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="150"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="Jméno:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,5,0"/>
            <TextBlock Text="{Binding firstName}" Grid.Row="0" Grid.Column="1" VerticalAlignment="Center"/>
            <TextBlock Text="Příjmení:" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Margin="0,5,5,0"/>
            <TextBlock Text="{Binding lastName}" Grid.Row="1" Grid.Column="1" VerticalAlignment="Center" Margin="0,5,0,0"/>
            <Button Content="Upravit" Grid.Row="2" Grid.Column="1" HorizontalAlignment="Left" Margin="0,10,0,0" Width="100"
                    Command="{Binding EditUserCommand}" Click="Edit_User"/>
            <Button Content="Reset hesla" Grid.Row="2" Grid.Column="1" HorizontalAlignment="Left" Margin="120,10,0,0" Width="100"
                    Command="{Binding ResetPasswordCommand}" Click="Reset_Password"/>

        </Grid>

        <!-- Tabs for related data -->
        <TabControl Grid.Row="1">
            <TabItem Header="Aktuální parkování">
                <DataGrid ItemsSource="{Binding currentParking}" AutoGenerateColumns="False" IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="SPZ" Binding="{Binding licensePlate}" />
                        <DataGridTextColumn Header="Parkoviště" Binding="{Binding parkingLotName}" />
                        <DataGridTextColumn Header="Místo" Binding="{Binding parkingSpaceId}" />
                        <DataGridTextColumn Header="Příjezd" Binding="{Binding arrivalTime}" />
                        <!-- Pokud chceš akce, přidej DataGridTemplateColumn -->
                        <DataGridTemplateColumn Header="Akce">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="Odparkovat" Click="UnparkCar_Click" Tag="{Binding}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>
            <TabItem Header="Historie parkování">
                <DataGrid ItemsSource="{Binding parkingHistory}" AutoGenerateColumns="True" IsReadOnly="True"/>
            </TabItem>
            <TabItem Header="Auta">
                <StackPanel>
                    <DataGrid ItemsSource="{Binding cars}" AutoGenerateColumns="False" IsReadOnly="True" CanUserAddRows="False">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="SPZ" Binding="{Binding licensePlate}" />
                            <DataGridTextColumn Header="Model" Binding="{Binding brandModel}" />
                            <DataGridTextColumn Header="Barva" Binding="{Binding color}" />
                            <DataGridTemplateColumn Header="Zaprkovat">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Zaparkovat"
                                                Click="ParkCar_Click"
                                                Tag="{Binding}">
                                            <Button.IsEnabled>
                                                <MultiBinding Converter="{StaticResource CarParkedToEnabledConverter}">
                                                    <Binding /> <!-- CarDto -->
                                                    <Binding Path="DataContext.currentParking" RelativeSource="{RelativeSource AncestorType=Window}" />
                                                </MultiBinding>
                                            </Button.IsEnabled>
                                        </Button>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="Odebrani">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Smazat" Click="DeleteCar_Click" Tag="{Binding carId}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <Button Content="Přidat auto" Click="Add_Car" Margin="0,10,0,0" Width="120" HorizontalAlignment="Left"/>
                </StackPanel>
            </TabItem>
        </TabControl>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="Zavřít" IsCancel="True" Width="100"/>
        </StackPanel>
    </Grid>
</Window>
